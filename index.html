<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wedding Invitation</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Preload key images for smoother animation -->
  <link rel="preload" as="image" href="bg-floral.png" />
  <link rel="preload" as="image" href="envelope.png" />
  <link rel="preload" as="image" href="envelope_open.png" />
  <link rel="preload" as="image" href="card1.png" />
  <link rel="preload" as="image" href="card2.png" />
  <link rel="preload" as="image" href="background_doa.png" />
</head>

<body class="locked">

  <!-- Sparkles overlay -->
  <div id="sparkles" aria-hidden="true"></div>

  <!-- Background music -->
  <audio id="bgm" src="music.mp3" preload="auto" loop></audio>

  <!-- Sound toggle (hidden until opened) -->
  <button id="soundToggle" class="soundToggle hidden" type="button" aria-label="Toggle sound">
    <span class="soundIcon" aria-hidden="true"></span>
  </button>

  <main class="page">

    <!-- ===== HERO / ENVELOPE STAGE ===== -->
    <section class="stage" id="stage">
      <div class="frame">

        <!-- Envelope image -->
        <img
          id="envelopeImg"
          class="envelopeImg"
          src="envelope.png"
          alt="Sealed envelope"
          draggable="false"
        />

        <!-- Invisible hit-area over the seal (NO text) -->
        <button id="sealBtn" class="sealHit" type="button" aria-label="Open envelope"></button>

        <!-- Flip card (slides up to cover envelope) -->
        <div id="flipContainer" class="flipContainer" aria-label="Invitation card (tap to flip)">
          <div id="flipCard" class="flipCard" role="button" tabindex="0" aria-label="Tap to flip card">
            <img class="cardFace cardFront" src="card1.png" alt="Card front" draggable="false" />
            <img class="cardFace cardBack"  src="card2.png" alt="Card back"  draggable="false" />
          </div>
          <div class="flipHint">Tap card to flip</div>
        </div>

      </div>
    </section>

    <!-- ===== DOA SECTION ===== -->
    <section class="section doa" id="doaSection">
      <div class="sectionFrame">
        <img
          class="fullCard"
          src="background_doa.png"
          alt="Doa background"
          draggable="false"
        />

        <!-- Doa text overlay (reveals line-by-line on scroll) -->
        <div class="doaText" id="doaText" aria-label="Doa text">
          <!-- Replace these lines with your real text if you want -->
          <div class="doaLine" data-i="1">ÙˆÙÙ…ÙÙ†Ù’ Ø¡ÙØ§ÙŠÙÙ€Ù°ØªÙÙ‡ÙÛ¦Ù“ Ø£ÙÙ†Ù’ Ø®ÙÙ„ÙÙ‚Ù Ù„ÙÙƒÙÙ… Ù…Ù‘ÙÙ†Ù’ Ø£ÙÙ†ÙÙØ³ÙÙƒÙÙ…Ù’ Ø£ÙØ²Ù’ÙˆÙÙ°Ø¬Ù‹Û­Ø§ Ù„Ù‘ÙØªÙØ³Ù’ÙƒÙÙ†ÙÙˆÙ“Ø§ÛŸ Ø¥ÙÙ„ÙÙŠÙ’Ù‡ÙØ§ ÙˆÙØ¬ÙØ¹ÙÙ„Ù Ø¨ÙÙŠÙ’Ù†ÙÙƒÙÙ… Ù…Ù‘ÙÙˆÙØ¯Ù‘ÙØ©Ù‹Û­ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©Ù‹ Ûš Ø¥ÙÙ†Ù‘Ù ÙÙÙ‰ Ø°ÙÙ°Ù„ÙÙƒÙ Ù„ÙÙ€Ù”ÙØ§ÙŠÙÙ€Ù°ØªÙÛ¢ Ù„Ù‘ÙÙ‚ÙÙˆÙ’Ù…ÙÛ¢ ÙŠÙØªÙÙÙÙƒÙ‘ÙØ±ÙÙˆÙ†Ù Ù¢Ù¡</div>
          <div class="doaLine" data-i="2">(30:21) And of His signs is that He created for you from yourselves mates that you may find tranquility in them;
and He placed between you affection and mercy. Verily in that are signs for those who reflect
</div>
          <div class="doaLine" data-i="1">Û Ù‡ÙÙˆÙ Ù±Ù„Ù‘ÙØ°ÙÙ‰ Ø®ÙÙ„ÙÙ‚ÙÙƒÙÙ… Ù…Ù‘ÙÙ† Ù†Ù‘ÙÙÙ’Ø³ÙÛ¢ ÙˆÙÙ°Ø­ÙØ¯ÙØ©ÙÛ¢ ÙˆÙØ¬ÙØ¹ÙÙ„Ù Ù…ÙÙ†Ù’Ù‡ÙØ§ Ø²ÙÙˆÙ’Ø¬ÙÙ‡ÙØ§ Ù„ÙÙŠÙØ³Ù’ÙƒÙÙ†Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡ÙØ§ Û– ÙÙÙ„ÙÙ…Ù‘ÙØ§ ØªÙØºÙØ´Ù‘ÙÙ‰Ù°Ù‡ÙØ§ Ø­ÙÙ…ÙÙ„ÙØªÙ’ Ø­ÙÙ…Ù’Ù„Ù‹Ø§ Ø®ÙÙÙÙŠÙÙ‹Û­Ø§ ÙÙÙ…ÙØ±Ù‘ÙØªÙ’ Ø¨ÙÙ‡ÙÛ¦ Û– ÙÙÙ„ÙÙ…Ù‘ÙØ§Ù“ Ø£ÙØ«Ù’Ù‚ÙÙ„ÙØª Ø¯Ù‘ÙØ¹ÙÙˆÙØ§ Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ø±ÙØ¨Ù‘ÙÙ‡ÙÙ…ÙØ§ Ù„ÙØ¦ÙÙ†Ù’ Ø¡ÙØ§ØªÙÙŠÙ’ØªÙÙ†ÙØ§ ØµÙÙ€Ù°Ù„ÙØ­Ù‹Û­Ø§ Ù„Ù‘ÙÙ†ÙÙƒÙÙˆÙ†ÙÙ†Ù‘Ù Ù…ÙÙ†Ù Ù±Ù„Ø´Ù‘ÙÙ€Ù°ÙƒÙØ±ÙÙŠÙ†Ù Ù¡Ù¨Ù©</div>
          <div class="doaLine" data-i="1">(7:189)It is He who created you from one soul and created from it its mate that he might dwell in security with her.
And when he covers her, she carries a light burden and continues therein.
And when it becomes heavy, they both invoke Allah, their Lord, â€œIf You should give us a good [child], we will surely be among the grateful.
</div>
        </div>
      </div>
    </section>

    <!-- ===== ACTIONS / COUNTDOWN / BUTTONS ===== -->
    <section class="section actions hiddenUntilOpened" id="actionsSection">
      <div class="glassCard">
        <h2 class="sectionTitle">Counting Down</h2>

        <div class="countdown" aria-label="Countdown timer">
          <div class="cdBox"><span id="cdDays" class="cdNum">00</span><span class="cdLbl">Days</span></div>
          <div class="cdBox"><span id="cdHours" class="cdNum">00</span><span class="cdLbl">Hours</span></div>
          <div class="cdBox"><span id="cdMins" class="cdNum">00</span><span class="cdLbl">Mins</span></div>
          <div class="cdBox"><span id="cdSecs" class="cdNum">00</span><span class="cdLbl">Secs</span></div>
        </div>

        <!-- Event date/time below countdown -->
        <div class="eventInfo" id="eventInfo">
          <div class="eventLine">ğŸ—“ï¸ Sabtu â€¢ 2 Mei 2026</div>
          <div class="eventLine">â° 11:30 AM â€“ 3:30 PM</div>
        </div>

        <div class="btnRow">
          <!-- Put your actual Google Maps link here -->
          <a class="pillBtn" href="https://maps.google.com" target="_blank" rel="noopener">
            ğŸ“ Buka Google Map
          </a>

          <!-- Put your actual RSVP link here -->
          <a class="pillBtn" href="https://forms.gle/" target="_blank" rel="noopener">
            ğŸ“ RSVP Sekarang
          </a>
        </div>
      </div>
    </section>

    <!-- ===== GALLERY (SWIPE SLIDER) ===== -->
    <section class="section gallery hiddenUntilOpened" id="gallerySection">
      <div class="glassCard">
        <h2 class="sectionTitle">Gallery</h2>

        <div class="galleryViewport" aria-label="Swipe gallery">
          <div class="galleryTrack" id="galleryTrack">
            <div class="slide"><img src="gallery1.jpeg" alt="Gallery 1" draggable="false"></div>
            <div class="slide"><img src="gallery2.jpeg" alt="Gallery 2" draggable="false"></div>
            <div class="slide"><img src="gallery3.jpeg" alt="Gallery 3" draggable="false"></div>
            <div class="slide"><img src="gallery4.jpeg" alt="Gallery 4" draggable="false"></div>
          </div>
        </div>

        <div class="dots" id="dots" aria-label="Gallery pagination">
          <button class="dot isActive" data-idx="0" aria-label="Go to slide 1"></button>
          <button class="dot" data-idx="1" aria-label="Go to slide 2"></button>
          <button class="dot" data-idx="2" aria-label="Go to slide 3"></button>
          <button class="dot" data-idx="3" aria-label="Go to slide 4"></button>
        </div>
      </div>
    </section>

  </main>

  <script>
    // ===== CONFIG =====
    const weddingDate = new Date("May 2, 2026 11:30:00").getTime();

    // ===== ELEMENTS =====
    const body = document.body;
    const sealBtn = document.getElementById("sealBtn");
    const envelopeImg = document.getElementById("envelopeImg");

    const flipContainer = document.getElementById("flipContainer");
    const flipCard = document.getElementById("flipCard");

    const sparkles = document.getElementById("sparkles");

    const bgm = document.getElementById("bgm");
    const soundToggle = document.getElementById("soundToggle");

    const actionsSection = document.getElementById("actionsSection");
    const gallerySection = document.getElementById("gallerySection");

    const doaLines = Array.from(document.querySelectorAll(".doaLine"));

    const galleryTrack = document.getElementById("galleryTrack");
    const dotsWrap = document.getElementById("dots");
    const dots = Array.from(dotsWrap.querySelectorAll(".dot"));

    // ===== STATE =====
    let opened = false;
    let galleryIndex = 0;

    // ===== HELPERS =====
    function lockScroll(lock) {
      if (lock) body.classList.add("locked");
      else body.classList.remove("locked");
    }

    function startSparkles() {
      sparkles.innerHTML = "";
      const count = 70;
      for (let i = 0; i < count; i++) {
        const s = document.createElement("span");
        s.className = "sparkle";
        s.style.left = Math.random() * 100 + "%";
        s.style.top = Math.random() * 100 + "%";
        s.style.animationDelay = (Math.random() * 2.2) + "s";
        s.style.animationDuration = (2.2 + Math.random() * 3.2) + "s";
        s.style.opacity = (0.25 + Math.random() * 0.75).toFixed(2);
        s.style.transform = `translate3d(0,0,0) scale(${0.6 + Math.random() * 1.4})`;
        sparkles.appendChild(s);
      }
      sparkles.classList.add("on");
    }

    function showOpenedSections() {
      actionsSection.classList.remove("hiddenUntilOpened");
      gallerySection.classList.remove("hiddenUntilOpened");
      actionsSection.classList.add("reveal");
      gallerySection.classList.add("reveal");
    }

    function revealCardAndEnableFlip() {
      // slide card up to cover envelope
      flipContainer.classList.add("show");
      setTimeout(() => {
        flipContainer.classList.add("ready");
        // enable scroll only after the main animation is done
        lockScroll(false);
        showOpenedSections();
      }, 950);
    }

    async function startMusic() {
      try {
        bgm.muted = false;
        await bgm.play();
        soundToggle.classList.remove("hidden");
        soundToggle.classList.remove("muted");
      } catch (e) {
        // Autoplay might be blocked on some devices; user can manually toggle
        soundToggle.classList.remove("hidden");
        soundToggle.classList.add("muted");
      }
    }

    function toggleSound() {
      if (bgm.paused) {
        bgm.play().then(() => {
          soundToggle.classList.remove("muted");
        }).catch(() => {});
      } else {
        bgm.pause();
        soundToggle.classList.add("muted");
      }
    }

    // ===== OPEN ENVELOPE FLOW =====
    sealBtn.addEventListener("click", async () => {
      if (opened) return;
      opened = true;

      lockScroll(true);

      envelopeImg.src = "envelope_open.png";
      envelopeImg.classList.add("opened");

      sealBtn.classList.add("hide");

      startSparkles();
      await startMusic();

      setTimeout(() => {
        revealCardAndEnableFlip();
      }, 500);
    });

    // ===== FLIP CARD (card1 <-> card2) =====
    function flipNow() {
      if (!flipContainer.classList.contains("ready")) return;
      flipCard.classList.toggle("flipped");
    }

    flipContainer.addEventListener("click", flipNow);
    flipCard.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        flipNow();
      }
    });

    // ===== SOUND TOGGLE =====
    soundToggle.addEventListener("click", toggleSound);

    // ===== DOA TEXT: reveal per-line as user scrolls =====
    // Each line appears when it enters viewport (so it feels tied to scrolling)
    const lineObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add("show");
      });
    }, { threshold: 0.55 });

    doaLines.forEach(line => lineObserver.observe(line));

    // ===== COUNTDOWN =====
    function pad2(n) { return String(n).padStart(2, "0"); }

    function tickCountdown() {
      const now = Date.now();
      let diff = Math.max(0, weddingDate - now);

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      diff -= days * (1000 * 60 * 60 * 24);

      const hours = Math.floor(diff / (1000 * 60 * 60));
      diff -= hours * (1000 * 60 * 60);

      const mins = Math.floor(diff / (1000 * 60));
      diff -= mins * (1000 * 60);

      const secs = Math.floor(diff / 1000);

      document.getElementById("cdDays").textContent = pad2(days);
      document.getElementById("cdHours").textContent = pad2(hours);
      document.getElementById("cdMins").textContent = pad2(mins);
      document.getElementById("cdSecs").textContent = pad2(secs);
    }
    setInterval(tickCountdown, 1000);
    tickCountdown();

    // ===== GALLERY SLIDER (swipe + dots) =====
    function setGalleryIndex(i) {
      galleryIndex = Math.max(0, Math.min(i, dots.length - 1));
      galleryTrack.style.transform = `translate3d(${-galleryIndex * 100}%, 0, 0)`;
      dots.forEach((d, idx) => d.classList.toggle("isActive", idx === galleryIndex));
    }

    dotsWrap.addEventListener("click", (e) => {
      const btn = e.target.closest(".dot");
      if (!btn) return;
      setGalleryIndex(Number(btn.dataset.idx || 0));
    });

    let startX = 0, currentX = 0, dragging = false;

    function onStart(e) {
      const p = e.touches ? e.touches[0] : e;
      startX = p.clientX;
      currentX = startX;
      dragging = true;
      galleryTrack.classList.add("dragging");
    }

    function onMove(e) {
      if (!dragging) return;
      const p = e.touches ? e.touches[0] : e;
      currentX = p.clientX;
    }

    function onEnd() {
      if (!dragging) return;
      dragging = false;
      galleryTrack.classList.remove("dragging");

      const dx = currentX - startX;
      const threshold = 45;

      if (dx < -threshold) setGalleryIndex(galleryIndex + 1);
      else if (dx > threshold) setGalleryIndex(galleryIndex - 1);
      else setGalleryIndex(galleryIndex);
    }

    const viewport = document.querySelector(".galleryViewport");
    viewport.addEventListener("touchstart", onStart, { passive: true });
    viewport.addEventListener("touchmove", onMove, { passive: true });
    viewport.addEventListener("touchend", onEnd);

    viewport.addEventListener("mousedown", onStart);
    window.addEventListener("mousemove", onMove);
    window.addEventListener("mouseup", onEnd);

    // Start at slide 1
    setGalleryIndex(0);
  </script>

</body>
</html>

