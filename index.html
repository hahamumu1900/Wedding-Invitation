<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Wedding Invitation</title>
<link rel="stylesheet" href="style.css" />

<!-- preload only first-screen assets -->
<link rel="preload" as="image" href="bg-floral.webp">
<link rel="preload" as="image" href="envelope.webp">
<link rel="preload" as="image" href="envelope_open.webp">
<link rel="preload" as="image" href="card1.webp">
</head>

<body class="locked">

<audio id="bgMusic" loop preload="none">
  <source src="music.mp3" type="audio/mpeg" />
</audio>

<button id="musicToggle" class="musicBtn" aria-label="Toggle music">ğŸ”Š</button>

<div id="sparkles"></div>

<section class="heroSection">
  <div class="stage">

    <div class="envelopeWrap">
      <img src="envelope.webp" id="envClosed" decoding="async" fetchpriority="high" alt="Envelope Closed">
      <img src="envelope_open.webp" id="envOpen" decoding="async" alt="Envelope Open">

      <!-- invisible seal hit area (no OPEN text) -->
      <button id="sealBtn" aria-label="Open invitation"></button>
    </div>

    <div class="cardLayer" id="cardLayer">
      <div class="flip-container" id="flipContainer">
        <div class="flipper" id="flipper">
          <div class="front">
            <img src="card1.webp" decoding="async" alt="Card Front">
          </div>
          <div class="back">
            <img src="card2.webp" decoding="async" alt="Card Back">
          </div>
        </div>
      </div>
      <p class="flipHint">Tap card to flip</p>
    </div>

  </div>
</section>

<main id="mainContent" class="content lockedContent">

<section class="doaSection">
  <div class="doaBlock">
    <img src="background_doa.webp" class="doaBg" loading="lazy" decoding="async" alt="Doa Background">

    <div class="doaText" id="doaText">
      <p class="line">ÙˆÙÙ…ÙÙ†Ù’ Ø¡ÙØ§ÙŠÙÙ€Ù°ØªÙÙ‡ÙÛ¦Ù“ Ø£ÙÙ†Ù’ Ø®ÙÙ„ÙÙ‚Ù Ù„ÙÙƒÙÙ… Ù…Ù‘ÙÙ†Ù’ Ø£ÙÙ†ÙÙØ³ÙÙƒÙÙ…Ù’ Ø£ÙØ²Ù’ÙˆÙÙ°Ø¬Ù‹Û­Ø§ Ù„Ù‘ÙØªÙØ³Ù’ÙƒÙÙ†ÙÙˆÙ“Ø§ÛŸ Ø¥ÙÙ„ÙÙŠÙ’Ù‡ÙØ§ ÙˆÙØ¬ÙØ¹ÙÙ„Ù Ø¨ÙÙŠÙ’Ù†ÙÙƒÙÙ… Ù…Ù‘ÙÙˆÙØ¯Ù‘ÙØ©Ù‹Û­ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©Ù‹ Ûš Ø¥ÙÙ†Ù‘Ù ÙÙÙ‰ Ø°ÙÙ°Ù„ÙÙƒÙ Ù„ÙÙ€Ù”ÙØ§ÙŠÙÙ€Ù°ØªÙÛ¢ Ù„Ù‘ÙÙ‚ÙÙˆÙ’Ù…ÙÛ¢ ÙŠÙØªÙÙÙÙƒÙ‘ÙØ±ÙÙˆÙ†Ù Ù¢Ù¡</p>
      <p class="line">(30:21) And of His signs is that He created for you from yourselves mates that you may find tranquility in them;</p>
      <p class="line">and He placed between you affection and mercy. Verily in that are signs for those who reflect</p>
      <p class="line">Û Ù‡ÙÙˆÙ Ù±Ù„Ù‘ÙØ°ÙÙ‰ Ø®ÙÙ„ÙÙ‚ÙÙƒÙÙ… Ù…Ù‘ÙÙ† Ù†Ù‘ÙÙÙ’Ø³ÙÛ¢ ÙˆÙÙ°Ø­ÙØ¯ÙØ©ÙÛ¢ ÙˆÙØ¬ÙØ¹ÙÙ„Ù Ù…ÙÙ†Ù’Ù‡ÙØ§ Ø²ÙÙˆÙ’Ø¬ÙÙ‡ÙØ§ Ù„ÙÙŠÙØ³Ù’ÙƒÙÙ†Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡ÙØ§ Û– ÙÙÙ„ÙÙ…Ù‘ÙØ§ ØªÙØºÙØ´Ù‘ÙÙ‰Ù°Ù‡ÙØ§ Ø­ÙÙ…ÙÙ„ÙØªÙ’ Ø­ÙÙ…Ù’Ù„Ù‹Ø§ Ø®ÙÙÙÙŠÙÙ‹Û­Ø§ ÙÙÙ…ÙØ±Ù‘ÙØªÙ’ Ø¨ÙÙ‡ÙÛ¦ Û– ÙÙÙ„ÙÙ…Ù‘ÙØ§Ù“ Ø£ÙØ«Ù’Ù‚ÙÙ„ÙØª Ø¯Ù‘ÙØ¹ÙÙˆÙØ§ Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ø±ÙØ¨Ù‘ÙÙ‡ÙÙ…ÙØ§ Ù„ÙØ¦ÙÙ†Ù’ Ø¡ÙØ§ØªÙÙŠÙ’ØªÙÙ†ÙØ§ ØµÙÙ€Ù°Ù„ÙØ­Ù‹Û­Ø§ Ù„Ù‘ÙÙ†ÙÙƒÙÙˆÙ†ÙÙ†Ù‘Ù Ù…ÙÙ†Ù Ù±Ù„Ø´Ù‘ÙÙ€Ù°ÙƒÙØ±ÙÙŠÙ†Ù Ù¡Ù¨Ù©</p>
      <p class="line">(7:189) It is He who created you from one soul and created from it its mate that he might dwell in security with her.</p>
      <p class="line">And when he covers her, she carries a light burden and continues therein.</p>
      <p class="line">And when it becomes heavy, they both invoke Allah, their Lord, â€œIf You should give us a good [child], we will surely be among the grateful.â€</p>
    </div>
  </div>
</section>

<section class="countdownSection">
  <h2 class="sectionTitle">Wedding Countdown</h2>
  <div id="countdown" class="countdownBox"></div>

  <div class="eventTime">
    ğŸ“… 2 May 2026<br>
    â° 11:30 AM â€“ 3:30 PM
  </div>

  <div class="ctaRow">
    <a class="btn" href="https://maps.app.goo.gl/dcHFg6xttDfwuXhg6" target="_blank" rel="noopener">ğŸ“ Google Map</a>
    <a class="btn btnSecondary" href="https://docs.google.com/forms/d/e/1FAIpQLSfBWe5IBelfTU7LKJhVfb5zdgDtQ7D1xK-jmd0pqqEJ1QBq4A/viewform" target="_blank" rel="noopener">RSVP</a>
  </div>
</section>

<section class="gallerySection">
  <h2 class="sectionTitle">Gallery</h2>

  <div class="galleryShell">
    <button id="galleryPrev" class="galleryNav" aria-label="Previous photo">â€¹</button>

    <div class="galleryViewport" id="galleryViewport">
      <div class="galleryTrack" id="galleryTrack">
        <figure class="gallerySlide"><img src="gallery1.webp" loading="lazy" decoding="async" alt="Gallery 1"></figure>
        <figure class="gallerySlide"><img src="gallery2.webp" loading="lazy" decoding="async" alt="Gallery 2"></figure>
        <figure class="gallerySlide"><img src="gallery3.webp" loading="lazy" decoding="async" alt="Gallery 3"></figure>
        <figure class="gallerySlide"><img src="gallery4.webp" loading="lazy" decoding="async" alt="Gallery 4"></figure>
      </div>
    </div>

    <button id="galleryNext" class="galleryNav" aria-label="Next photo">â€º</button>
  </div>

  <div id="galleryDots" class="galleryDots" aria-label="Gallery pagination"></div>
</section>

</main>

<script>
/* ===== open envelope flow (kept) ===== */
const body = document.body;
const sealBtn = document.getElementById("sealBtn");
const envClosed = document.getElementById("envClosed");
const envOpen = document.getElementById("envOpen");
const cardLayer = document.getElementById("cardLayer");
const flipContainer = document.getElementById("flipContainer"); // FIX: was missing
const flipper = document.getElementById("flipper");
const mainContent = document.getElementById("mainContent");
const music = document.getElementById("bgMusic");
const musicBtn = document.getElementById("musicToggle");

let opened = false;

sealBtn.onclick = async () => {
  if (opened) return;
  opened = true;

  envClosed.classList.add("hide");
  envOpen.classList.add("show");

  startSparklesLight();

  body.classList.remove("locked");
  mainContent.classList.remove("lockedContent");

  try { await music.play(); } catch(e) {}

  setTimeout(() => {
    cardLayer.classList.add("show", "flyUp");
    setTimeout(() => cardLayer.classList.add("ready"), 900);
  }, 420);

  // Enable Doa reveal after opening (so it doesn't run before scroll is unlocked)
  initDoaReveal();
};

/* music toggle */
musicBtn.onclick = async () => {
  if (music.paused) {
    try { await music.play(); } catch(e) {}
    musicBtn.textContent = "ğŸ”Š";
  } else {
    music.pause();
    musicBtn.textContent = "ğŸ”‡";
  }
};

/* flip (kept, but fixed to use defined flipContainer) */
flipContainer.onclick = () => {
  if (cardLayer.classList.contains("ready")) flipper.classList.toggle("flip");
};

/* ===== DOA: reveal 1-by-1 while scrolling ===== */
function initDoaReveal(){
  const lines = Array.from(document.querySelectorAll("#doaText .line"));
  // reset (in case user reloads from cache)
  lines.forEach(l => l.classList.remove("show"));

  const io = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) return;
      const el = entry.target;
      // small stagger based on order for premium feel
      const idx = lines.indexOf(el);
      setTimeout(() => el.classList.add("show"), Math.min(idx * 90, 450));
      io.unobserve(el);
    });
  }, { threshold: 0.55 });

  lines.forEach(el => io.observe(el));
}

/* ===== LIGHTWEIGHT SPARKLES (POOL) ===== */
const sparkWrap = document.getElementById("sparkles");
let sparkPool = [];
let sparkTimer = null;

function startSparklesLight(){
  if (sparkTimer) return;

  if (!sparkPool.length){
    for (let i = 0; i < 18; i++){
      const s = document.createElement("div");
      s.className = "spark";
      sparkWrap.appendChild(s);
      sparkPool.push(s);
    }
  }

  let i = 0;
  sparkTimer = setInterval(() => {
    const s = sparkPool[i % sparkPool.length];
    i++;
    s.style.left = (Math.random() * 100) + "vw";
    s.style.animationDuration = (3 + Math.random() * 2) + "s";
    s.classList.remove("go");
    void s.offsetWidth;
    s.classList.add("go");
  }, 220);
}

/* ===== GALLERY: swipe + buttons + dots ===== */
const galleryViewport = document.getElementById("galleryViewport");
const galleryTrack = document.getElementById("galleryTrack");
const btnPrev = document.getElementById("galleryPrev");
const btnNext = document.getElementById("galleryNext");
const dotsWrap = document.getElementById("galleryDots");

const slides = Array.from(galleryTrack.querySelectorAll(".gallerySlide"));
let gIndex = 0;

function buildDots(){
  dotsWrap.innerHTML = "";
  slides.forEach((_, i) => {
    const b = document.createElement("button");
    b.className = "gdot" + (i === 0 ? " active" : "");
    b.setAttribute("aria-label", "Go to photo " + (i + 1));
    b.onclick = () => goTo(i);
    dotsWrap.appendChild(b);
  });
}

function updateDots(){
  const dots = Array.from(dotsWrap.children);
  dots.forEach((d, i) => d.classList.toggle("active", i === gIndex));
}

function goTo(i){
  gIndex = (i + slides.length) % slides.length;
  galleryTrack.style.transform = `translate3d(${-gIndex * 100}%,0,0)`;
  updateDots();
}

btnPrev.onclick = () => goTo(gIndex - 1);
btnNext.onclick = () => goTo(gIndex + 1);

buildDots();
goTo(0);

/* swipe handling */
let startX = 0, startY = 0, dragging = false;

galleryViewport.addEventListener("pointerdown", (e) => {
  dragging = true;
  startX = e.clientX;
  startY = e.clientY;
  galleryViewport.setPointerCapture(e.pointerId);
}, { passive: true });

galleryViewport.addEventListener("pointermove", (e) => {
  if (!dragging) return;
  const dx = e.clientX - startX;
  const dy = e.clientY - startY;

  // If the user is clearly swiping horizontally, prevent the "image too big" feeling
  // by using it only to change slides (not pan the image).
  if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 6) {
    e.preventDefault?.();
  }
}, { passive: false });

galleryViewport.addEventListener("pointerup", (e) => {
  if (!dragging) return;
  dragging = false;

  const dx = e.clientX - startX;
  const dy = e.clientY - startY;

  if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 45) {
    if (dx < 0) goTo(gIndex + 1);
    else goTo(gIndex - 1);
  }
}, { passive: true });

/* ===== Countdown (if you already had it earlier, keep yours; this is safe) ===== */
const countdownEl = document.getElementById("countdown");
const eventDate = new Date("2026-05-02T11:30:00+08:00");

function tickCountdown(){
  const now = new Date();
  const diff = eventDate - now;

  if (diff <= 0){
    countdownEl.textContent = "Itâ€™s today! ğŸ‰";
    return;
  }

  const s = Math.floor(diff / 1000);
  const d = Math.floor(s / 86400);
  const h = Math.floor((s % 86400) / 3600);
  const m = Math.floor((s % 3600) / 60);
  const ss = s % 60;

  countdownEl.textContent = `${d}d ${h}h ${m}m ${ss}s`;
}
tickCountdown();
setInterval(tickCountdown, 1000);
</script>

</body>
</html>

