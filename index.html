<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Wedding Invitation</title>

<link rel="stylesheet" href="style.css">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>

<div class="camera" id="camera">
<div class="wrapper">

<!-- ================= COVER ================= -->

<div id="coverStage" class="stage">
  <img src="cover.png" class="full-img">

  <div id="seal" class="seal-click"></div>
  <div id="sealGlow" class="seal-glow"></div>
</div>

<!-- ================= OPEN ENVELOPE ================= -->

<div id="openStage" class="stage hidden">
  <img src="card1.png" class="full-img envelope-open">
</div>

<!-- ================= LETTER CONTENT ================= -->

<div id="letterStage" class="stage hidden">

  <img src="card2.png" class="letter letter-main" id="card2">
  <img src="card3.png" class="letter">
  <img src="card4.png" class="letter">

  <!-- COUNTDOWN -->

  <div class="countdown">
    <div class="event-card">
      <div class="event-title">Majlis Bermula Dalam</div>
      <div id="timer" class="timer"></div>

      <div class="event-text">
        Glo Damansara Shopping Mall<br>
        Petaling Jaya<br><br>
        Sabtu • 2 Mei 2026 • 11:00 pagi
      </div>

      <a class="map-btn"
      href="https://maps.app.goo.gl/E8qS2P7xVHtyL8967"
      target="_blank">
      Buka Google Map
      </a>
    </div>
  </div>

  <!-- GALLERY -->

  <div class="gallery">
    <div class="gallery-grid">
      <img src="gallery1.jpg">
      <img src="gallery2.jpg">
      <img src="gallery3.jpg">
      <img src="gallery4.jpg">
    </div>

    <a class="rsvp-btn"
    href="https://forms.gle/KYxswksdS9Qqm9YC8"
    target="_blank">
    RSVP Sekarang
    </a>
  </div>

</div>

</div>
</div>

<!-- overlays -->
<div class="vignette"></div>
<div class="sparkle-layer" id="dust"></div>

<audio id="bgm" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>

/* ================= SAFE EVENT BIND ================= */

const seal = document.getElementById("seal");
seal.addEventListener("click", startOpen);
seal.addEventListener("touchstart", startOpen, {passive:true});

let isOpening = false;

/* ================= OPEN SEQUENCE ================= */

function startOpen(){
  if(isOpening) return;
  isOpening = true;
  
  glowFlash();
  cameraZoom();
  musicFadeIn();

  document.getElementById("coverStage").classList.add("fade-out");

  setTimeout(()=>{
    document.getElementById("coverStage").classList.add("hidden");
    showOpenEnvelope();
  },800);
}

/* ================= EFFECTS ================= */

function glowFlash(){
  const glow = document.getElementById("sealGlow");
  glow.classList.remove("glow-on");
  void glow.offsetWidth; // Trigger reflow
  glow.classList.add("glow-on");
}

function cameraZoom(){
  document.getElementById("camera").classList.add("camera-zoom");
}

function musicFadeIn(){
  const m = document.getElementById("bgm");
  m.volume = 0;
  m.play().catch((e)=>{console.log("Audio play prevented:", e)});
  
  let v = 0;
  const f = setInterval(()=>{
    v += 0.03;
    m.volume = Math.min(v, 0.7);
    if(v >= 0.7) clearInterval(f);
  },100);
}

/* ================= STAGE 2 ================= */

function showOpenEnvelope(){
  const open = document.getElementById("openStage");
  open.classList.remove("hidden");
  
  // Force reflow
  void open.offsetWidth;
  
  open.classList.add("open-zoom");
  
  // Animate letters sequentially
  setTimeout(() => {
    document.getElementById("openStage").classList.add("fade-out");
    setTimeout(showLetter, 400);
  }, 800);
}

/* ================= STAGE 3 ================= */

function showLetter(){
  const stage = document.getElementById("letterStage");
  stage.classList.remove("hidden");
  
  // Animate letters with staggered delay
  const letters = document.querySelectorAll('.letter');
  letters.forEach((letter, index) => {
    setTimeout(() => {
      letter.classList.add('letter-out');
    }, 300 * index);
  });
  
  // Add more dust after letters appear
  setTimeout(() => {
    spawnDust(40);
  }, 1200);
}

/* ================= COUNTDOWN ================= */

const targetDate = new Date("May 2, 2026 11:00:00").getTime();

function updateCountdown() {
  const el = document.getElementById("timer");
  if(!el) return;

  const now = Date.now();
  const diff = targetDate - now;
  
  if(diff <= 0) {
    el.innerHTML = "Majlis Telah Bermula!";
    return;
  }

  const d = Math.floor(diff/(1000*60*60*24));
  const h = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
  const m = Math.floor((diff%(1000*60*60))/(1000*60));
  const s = Math.floor((diff%(1000*60))/1000);

  el.innerHTML = `${d} hari ${h} jam ${m} minit ${s} saat`;
}

// Update immediately and then every second
updateCountdown();
setInterval(updateCountdown, 1000);

/* ================= GOLD DUST ================= */

function spawnDust(n){
  const layer = document.getElementById("dust");
  const existingDust = layer.querySelectorAll('.dust').length;
  
  // Limit total dust particles
  if(existingDust > 100) return;
  
  for(let i = 0; i < n; i++){
    const d = document.createElement("div");
    d.className = "dust";
    
    // Random positioning with some distribution logic
    const leftPos = 10 + Math.random() * 80;
    d.style.left = leftPos + "%";
    
    // Random size and animation
    const size = 3 + Math.random() * 5;
    d.style.width = size + "px";
    d.style.height = size + "px";
    
    const duration = 15 + Math.random() * 20;
    d.style.animationDuration = duration + "s";
    d.style.animationDelay = Math.random() * 15 + "s";
    
    // Random opacity
    d.style.opacity = 0.3 + Math.random() * 0.5;
    
    layer.appendChild(d);
    
    // Remove dust after animation completes
    setTimeout(() => {
      if(d.parentNode === layer) {
        layer.removeChild(d);
      }
    }, (duration + parseFloat(d.style.animationDelay)) * 1000);
  }
}

/* ================= SMOOTH SCROLL BEHAVIOR ================= */

document.documentElement.style.scrollBehavior = 'smooth';

/* start base dust immediately */
window.addEventListener('load', () => {
  spawnDust(30);
});

</script>

</body>
</html>
